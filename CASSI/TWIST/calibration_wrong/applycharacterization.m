%==================================================%
% Apply the Spectral Calibration for x_twist
% Author: (c) 2011 Min H. Kim (Yale University)
%==================================================%
% x   <-- 24x24 transform
% b1  <-- Radiometric measurements by a spectroradiometer
% b2  <-- Characterized CASSI measurements
% CV1 <-- CV between CASSI (Amo) and spectroradiometer (bo)
% CV2 <-- CV between characterized CASSI (bo2) and spectroradiometer (bo)
% A   <-- CASSI measurements
%==================================================%
function x_twist2 = applycharacterization(x_twist)
    % Min's Cassi characterization model for visible spectrum
    % spectra channel --> 10
    % [450,464,480,497,516,537,560,586,614,645;] % floored
    x = [-0.00378802055008368,-0.0175766502400538,-0.0263145794051746,...
        -0.0244164143786656,-0.0227887542191146,-0.0217693136307402,...
        -0.0125991577242279,-0.0188020169638327,-0.0193922594207567,...
        -0.00646574917150315;0.0462643923494617,0.0516118333406742,...
        0.0386389523795411,0.0243047245150367,0.0237070279185948,...
        0.0246241117042528,0.0182026879256964,0.0166098209948057,...
        0.0129825422472368,0.0137830372968752;-0.0105432318218975,...
        0.00410591754281902,0.0141269645967080,0.00634387558664264,...
        -0.00214854153438307,0.000568528468661149,-0.00219969960307999,...
        0.00392114613034492,0.00231655087718090,-0.00708355570731090;...
        0.000528863754279690,-0.00769818678462154,-0.00581969162133357,...
        0.00513896823563916,-0.00508754429690971,-0.0157297153067079,...
        -0.0126396057240978,-0.0110038052358791,-0.00246461785029701,...
        -0.00133574937223155;0.000648857130678205,0.00722030312752856,...
        0.0135973287640310,0.0211524334179926,0.0311651011479696,...
        0.0174329373134576,0.00963871205437830,0.00779786057189574,...
        0.00924214698994150,-0.00291996226347922;-0.000395865504131008,...
        0.00121539896379231,0.000282228717870720,-0.00379087539216821,...
        -0.00166367438873644,0.0108867362241051,0.00585479216694058,...
        -0.00335022981251476,-0.00919189342454035,0.00671372603699417;...
        -0.00192574916849963,-0.00805719645697613,-0.0112546931103915,...
        -0.00808450119477016,-0.00211961145745764,0.00613159437265038,...
        0.0132618158537747,0.00156721406264933,-0.000391451901236183,...
        -0.000219520672439476;0.00369356773825932,0.00584732071944795,...
        0.00708626875542680,0.00477069410065180,0.00214933120250606,...
        0.000325153661366379,0.00234865732001916,0.0235245491890186,...
        0.00379473109966254,-0.00131269462374646;-0.00545257967962162,...
        -0.00125436456067672,0.00100270032292921,0.00455696583678599,...
        0.00942794079790390,0.00659770297506096,0.00431855118743610,...
        -0.00305304497675005,0.0218542929233148,-0.00264221217139571;...
        0.00445654698660384,0.000786917643810983,-0.00122506343502931,...
        -0.00317128919150173,-0.00659599606985103,-0.00484758235281269,...
        -0.00278720181785844,0.00237498159097933,0.000410404214989900,...
        0.0202182128500613;];

    h = size(x_twist,1);
    w = size(x_twist,2);
    d = size(x_twist,3);
    
    vx1 = reshape(x_twist, [h*w,d]);
    vx2 = vx1*x;
    x_twist2 = reshape(vx2, [h,w,d]);
end